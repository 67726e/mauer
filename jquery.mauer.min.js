(function(b,a,c){b.mauer=function(d,f,e){this.$element=b(e);this.$window=b(a);this.options=b.extend(b.mauer.defaults,d);this.init();if(typeof f==="function"){f.call(e)}};b.mauer.defaults={columnWidth:360,gutterWidth:20,gutterHeight:20,filter:c,initCallback:c,calculateCallback:c,mauerCallback:c,resizeCallback:c};b.mauer.prototype={columns:0,columnWidth:0,containerWidth:0,positions:new Array(0),init:function(){this.$element.data("mauer",this);this.resize();var d=this;this.$window.bind("resize.mauer",function(){d.resize.apply(d)});if(typeof this.options.initCallback==="function"){this.options.initCallback.call()}},resize:function(){this.calculate();this.mauer(this.$element.children().not(this.options.filter));this.$element.height(this.$element.get(0).scrollHeight);if(typeof this.options.resizeCallback==="function"){this.options.resizeCallback.call()}},calculate:function(){this.columnWidth=this.options.columnWidth;this.$element.css("width","100%");this.containerWidth=this.$element.width();if(typeof this.columnWidth==="function"){this.columnWidth=this.columnWidth.call(this,this.containerWidth)}this.columns=Math.floor(this.containerWidth/(this.columnWidth+this.options.gutterWidth));this.positions=new Array(this.columns);var f=(this.columns>0)?((this.columns-1)*this.options.gutterWidth):0;var d=(this.columns*this.columnWidth);this.$element.css("width",(d+f)+"px");for(var e=0;e<this.columns;e++){this.positions[e]=0}if(typeof this.options.calculateCallback==="function"){this.options.calculateCallback.call()}},calculateColumn:function(){var f=0,d=this.positions[0];for(var e=0;e<this.positions.length;e++){if(this.positions[e]<d){d=this.positions[e];f=e}}return f},mauer:function(e){var d=this;e.each(function(i,j){var h=b(j);var k=d.calculateColumn();var f=(k*(d.columnWidth+d.options.gutterWidth));var l=d.positions[k];var g=h.height();d.positions[k]+=(g+d.options.gutterHeight);h.css({position:"absolute",left:f,top:l});h.addClass("stein")})},append:function(d,e){this.mauer(d.not(this.options.filter));if(typeof e==="function"){e.call()}}};b.fn.mauer=function(f,h){var g=typeof f;var d=this.data("mauer");switch(g){case"string":var e=Array.prototype.slice.call(arguments,1);d[f].apply(d,e);if(typeof h==="function"){h.apply(d)}break;default:case"object":if(d===c){d=new b.mauer(f,h,this)}break}}})(jQuery,window);
